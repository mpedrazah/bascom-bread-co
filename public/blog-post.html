<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blog Post - Bascom Bread</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* Space for your fixed header (slightly more generous) */
    body { padding-top: 140px; }

    /* Make sure header always sits above content/images */
    header { position: fixed; top: 0; left: 0; right: 0; z-index: 3000; }

    .post { max-width: 820px; margin: 0 auto 80px; padding: 0 20px; }
    .post-header { text-align: center; margin-bottom: 18px; }
    .post-title {
      font-family: "Playfair Display", serif;
      font-size: clamp(28px, 4vw, 44px);
      line-height: 1.2;
      margin: 0 0 8px;
    }
    .post-meta { color: #777; font-size: 0.95rem; margin: 0 0 18px; }

    /* Hero image: nudge down + ensure normal positioning */
    .post-hero { margin: 24px auto 28px; }
    .post-hero img {
      display: block;
      width: 100%;
      max-height: 420px;         /* prevents huge images */
      object-fit: cover;         /* tasteful crop */
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      position: static;          /* don’t allow fixed/absolute to sneak in */
      z-index: 1;                /* sits under the header’s z-index anyway */
    }

    /* Body typography (works with Quill HTML) */
    .post-body { color: #2a2a2a; position: relative; z-index: 1; }
    .post-body p {
      font-size: 1.08rem;
      line-height: 1.85;
      margin: 0 0 1.1rem;
    }
    .post-body h2, .post-body h3 {
      font-family: "Playfair Display", serif;
      margin: 2rem 0 0.75rem;
      line-height: 1.25;
    }
    .post-body h2 { font-size: 1.6rem; }
    .post-body h3 { font-size: 1.3rem; }
    .post-body ul, .post-body ol { margin: 0 0 1.1rem 1.5rem; line-height: 1.8; }
    .post-body blockquote {
      margin: 1.4rem 0; padding: 1rem 1.2rem;
      background: #f8f6f0; border-left: 4px solid #b8860b; border-radius: 6px;
      color: #4a4a4a; font-style: italic;
    }
    .post-body a { color: #6a8667; text-decoration: underline; }
    .post-body strong { color: #1f1f1f; }
    .post-body img {
      max-width: 100%; height: auto; display: block;
      margin: 1.2rem auto; border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      position: static;
    }

    /* Optional drop cap on first paragraph */
    .post-body p:first-of-type::first-letter {
      font-family: "Playfair Display", serif;
      float: left; font-size: 3.1rem; line-height: 0.9;
      padding: 0.25rem 0.5rem 0 0.25rem; color: #b8860b;
    }
  </style>
</head>
<body>

  <header>
    <div class="logo-container">
      <img src="images/bread-logoV2.webp" alt="Bascom Bread Logo" class="logo">
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="products.html">Shop</a></li>
        <li><a href="blog.html">Blog</a></li>
      </ul>
    </nav>
  </header>

  <main id="post-container" class="post">
    <p>Loading...</p>
  </main>

  <script>
    async function loadPost() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if (!id) return;

      const container = document.getElementById("post-container");

      try {
        const res = await fetch(`/api/posts/${id}`);
        if (!res.ok) throw new Error(`Failed to fetch post: ${res.status}`);
        const post = await res.json();

        // If story is plain text (no tags), convert newlines to paragraphs.
        const storyLooksHtml = /<[^>]+>/.test(post.story || "");
        const storyHtml = storyLooksHtml
          ? post.story
          : `<p>${(post.story || "")
                .trim()
                .replace(/\n{2,}/g, "</p><p>")
                .replace(/\n/g, "<br>")}</p>`;

        container.innerHTML = `
          <article>
            <header class="post-header">
              <h1 class="post-title">${post.title}</h1>
              <p class="post-meta">Posted on ${new Date(post.created_at).toLocaleDateString()}</p>
              ${post.image_url ? `
                <figure class="post-hero">
                  <img src="${post.image_url}" alt="${post.title}">
                </figure>` : "" }
            </header>
            <div class="post-body">${storyHtml}</div>
          </article>
        `;
      } catch (err) {
        console.error("❌ Failed to load post:", err);
        container.innerHTML = `<p style="color:red;">Error loading post. Try again later.</p>`;
      }
    }

    document.addEventListener("DOMContentLoaded", loadPost);
  </script>

</body>
</html>
